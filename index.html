<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>FDB Port Manager</title>
  <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    table { border-collapse: collapse; width: 100%; max-width: 600px; margin: auto; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    th { background: #f5f5f5; }
    .uid {
      cursor: grab;
      background: #e0f7fa;
      padding: 5px;
      border-radius: 4px;
      margin: 2px;
    }
    .sortable-swap-highlight {
      background: #ffe082 !important;
    }
  </style>
</head>
<body>
  <h2>FDB Ports</h2>
  <table id="portsTable">
    <thead>
      <tr><th>Port</th><th>UID</th></tr>
    </thead>
    <tbody id="uidList">
      <!-- Rows will be filled dynamically -->
    </tbody>
  </table>

  <script>
    async function loadData() {
      const params = new URLSearchParams(window.location.search);
      const jsonUrl = params.get("json");
      if (!jsonUrl) return alert("No JSON provided");

      const res = await fetch(jsonUrl);
      const data = await res.json();

      const tbody = document.getElementById("uidList");
      data.port_uid.forEach(p => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${p.port}</td>
          <td><div class="uid" data-port="${p.port}">${p.uid}</div></td>
        `;
        tbody.appendChild(row);
      });

      // Make UIDs draggable/swappable
      new Sortable(tbody, {
        animation: 150,
        swap: true,              // swap mode
        swapClass: "sortable-swap-highlight",
        draggable: ".uid",       // only UIDs can be dragged
        onEnd: function (evt) {
          // Nothing else needed â€“ swap is automatic
        }
      });
    }

    loadData();
  </script>
</body>
</html>
