<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>FDB Viewer</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
  <h2>FDB JSON Result</h2>
  <div id="meta">Waiting for data...</div>
  <table id="ports"><thead><tr><th>Port</th><th>UID</th><th>Info</th></tr></thead><tbody></tbody></table>

  <script>
    const tg = window.Telegram.WebApp;
    tg.expand();

    console.log("[webapp] loaded, sending data request...");
    tg.sendData("get_json"); // üîë Ask bot for data

    tg.onEvent("webAppData", (event) => {
      console.log("[webapp] received event:", event);

      try {
        const json = JSON.parse(event.data);
        console.log("[webapp] parsed JSON:", json);

        document.getElementById("meta").innerHTML = `
          <p><b>FDB:</b> ${json.fdb}</p>
          <p><b>Splitter:</b> ${json.splitter}</p>
        `;

        const tbody = document.querySelector("#ports tbody");
        tbody.innerHTML = "";
        json.port_uid.forEach(p => {
          tbody.insertAdjacentHTML("beforeend", `
            <tr><td>${p.port}</td><td>${p.uid}</td><td>${p.optional_info ?? "-"}</td></tr>
          `);
        });
      } catch (e) {
        document.getElementById("meta").innerText = "‚ùå Error parsing data: " + e;
      }
    });
  </script>
</body>
</html>
