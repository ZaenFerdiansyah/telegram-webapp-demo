<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>FDB Viewer</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    h2 { color: #2c3e50; }
    table { border-collapse: collapse; width: 100%; margin-top: 10px; }
    table, th, td { border: 1px solid #ddd; }
    th, td { padding: 8px; text-align: left; }
    th { background: #f4f4f4; }
    pre { background: #f9f9f9; padding: 10px; border-radius: 6px; }
  </style>
</head>
<body>
  <h2>FDB JSON Result</h2>
  <div id="meta"></div>
  <table id="ports">
    <thead>
      <tr><th>Port</th><th>UID</th><th>Optional Info</th></tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    const params = new URLSearchParams(window.location.search);
    const fileId = params.get("file_id");

    if (!fileId) {
      document.body.innerHTML = "<p style='color:red'>No file_id provided!</p>";
    } else {
      const BOT_TOKEN = "7471839903:AAEtTRTDnCwky24nat6k5Ov6zEV6kvScWuc"; // ⚠️ must be safe (see note below)

      fetch(`https://api.telegram.org/bot${BOT_TOKEN}/getFile?file_id=${fileId}`)
        .then(r => r.json())
        .then(data => {
          const filePath = data.result.file_path;
          return fetch(`https://api.telegram.org/file/bot${BOT_TOKEN}/${filePath}`);
        })
        .then(r => r.json())
        .then(json => {
          document.getElementById("meta").innerHTML = `
            <p><b>FDB:</b> ${json.fdb}</p>
            <p><b>Splitter:</b> ${json.splitter}</p>
          `;
          const tbody = document.querySelector("#ports tbody");
          json.port_uid.forEach(p => {
            const row = `<tr>
              <td>${p.port}</td>
              <td>${p.uid}</td>
              <td>${p.optional_info ?? "-"}</td>
            </tr>`;
            tbody.insertAdjacentHTML("beforeend", row);
          });
        })
        .catch(err => {
          document.body.innerHTML = `<p style='color:red'>Error: ${err}</p>`;
        });
    }
  </script>
</body>
</html>
